<!-- template name: AccountListActivityView-->
{% extends "budgetdb/base.html" %}
{% load static %}
{% block title %}
    {{ account_name }}
{% endblock %}
{% block headblock %}
    <link rel="stylesheet" type="text/css" href="{% static 'budgetdb/colorcodes.css' %}">
{% endblock %}
{% block content %}

<style>
tbody>tr>:nth-child(1){
 width:5px;
 text-align:left;
}
tbody>tr>:nth-child(2){
 width:80px;
 text-align:left;
}
tbody>tr>:nth-child(3){
 width:80px;
 text-align:left;
}
tbody>tr>:nth-child(4){
 width:300px;
 text-align:left;
}
tbody>tr>:nth-child(5){
 width:100px;
 text-align:center;
}
tbody>tr>:nth-child(6){
 width:120px;
 text-align:left;
}
tbody>tr>:nth-child(7){
 width:120px;
 text-align:left;
}
tbody>tr>:nth-child(8){
 width:70px;
 text-align:right;
}
tbody>tr>:nth-child(9){
 width:70px;
 text-align:right;
}
tbody>tr>:nth-child(10){
 width:70px;
 text-align:right;
}
tbody>tr>:nth-child(11){
 width:90px;
 text-align:right;
}
tbody>tr>:nth-child(12){
 width:70px;
 text-align:right;
}

button.audit::before {
  font-family: fontAwesome;
  content: "\f560";
}


button.NORECEIPT::before {
  font-family: fontAwesome;
  content: "\f0c8";
}
button.RECEIPT::before {
  font-family: fontAwesome;
  content: "\f14a";
}


tr.UNVERIFIED_MANUAL_BUDGET button.verify::before {
  font-family: fontAwesome;
  content: "\f0c8";
}
tr.UNVERIFIED_BUDGET button.verify::before {
  font-family: fontAwesome;
  content: "\f0c8";
}
tr.UNVERIFIED_MANUAL button.verify::before {
  font-family: fontAwesome;
  content: "\f0c8";
}
tr.UNVERIFIED button.verify::before {
  font-family: fontAwesome;
  content: "\f0c8";
}

tr.VERIFIED_MANUAL_BUDGET button.verify::before {
  font-family: fontAwesome;
  content: "\f14a";
}
tr.VERIFIED_BUDGET button.verify::before {
  font-family: fontAwesome;
  content: "\f14a";
}
tr.VERIFIED_MANUAL button.verify::before {
  font-family: fontAwesome;
  content: "\f14a";
}
tr.VERIFIED button.verify::before {
  font-family: fontAwesome;
  content: "\f14a";
}






</style>

<h3>Account {{ account_name }}</h3>
{% if error_message %}<p><strong>{{ error_message }}</strong></p>{% endif %}

<table class="table table-hover table-sm ">
    <tr>
        <th id=c1><a href="{% url 'budgetdb:create_transaction' %}">
            <i class="fas fa-plus"></i>
        </a></th>
        <th id=c2>Date</th>
        <th id=c3>Statement</th>
        <th id=c4>Description</th>
        <th id=c5>Recurrence</th>
        <th id=c6>Category</th>
        <th id=c7>Subcategory</th>
        <th id=c8>Amount</th>
        <th id=c9>Verified</th>
        <th id=c10>Receipt</th>
        <th id=c11>Balance</th>
        <th id=c12>Audit</th>
    </tr>

    {% for event in object_list reversed %}
    <tr {% if event.audit == 1 %} class="AUDIT" 
        {% elif event.budgetedevent_id != None and event.verified == 0 and event.ismanual == 1 %} class="UNVERIFIED_MANUAL_BUDGET" 
        {% elif event.budgetedevent_id != None and event.verified == 1 and event.ismanual == 1 %} class="VERIFIED_MANUAL_BUDGET" 
        {% elif event.budgetedevent_id != None and event.verified == 0 and event.ismanual == 0 %} class="UNVERIFIED_BUDGET" 
        {% elif event.budgetedevent_id != None and event.verified == 1 and event.ismanual == 0 %} class="VERIFIED_BUDGET" 
        {% elif event.verified == 1 and event.ismanual == 1 %} class="VERIFIED_MANUAL" 
        {% elif event.verified == 0 and event.ismanual == 1 %} class="UNVERIFIED_MANUAL" 
        {% elif event.verified == 1 %} class="VERIFIED" 
        {% else %} class="UNVERIFIED" 
        {% endif %}
        id=T{{event.id}}
    >
        <td><a href="{% url 'budgetdb:create_transaction_from_date_account' event.date_actual|date:'Y-m-d' pk %}" target="popup" onclick="window.open('{% url 'budgetdb:create_transaction_from_date_account' event.date_actual|date:'Y-m-d' pk %}','popup','width=1000,height=700'); return false;" >
            <i class="fas fa-plus"></i>
        </a></td>
        <td>{{ event.date_actual|date:'Y-m-d' }}</td>
        <td>{% if event.statement != None %} {{ event.statement }} {% endif %}</td>
        <td><a href="{% url 'budgetdb:update_transaction_popup' event.id %}" 
               target="popup" 
               onclick="window.open('{% url 'budgetdb:update_transaction_popup' event.id %}','popup','width=1000,height=700'); return false;" 
               >
                {{ event.description }}
                {% if event.cat2.id == 8 %}
                {% if event.account_destination and event.account_destination.name != account_name%}
                <button type="button" class="btn btn-outline-info btn-sm"> <i class="fas fa-arrow-right"></i> {{event.account_destination}} </button>
                {% elif event.account_source and event.account_source.name != account_name %}
                <button type="button" class="btn btn-outline-info btn-sm">     <i class="fas fa-arrow-left"></i> {{event.account_source}}</button>
                {% endif %}
                {% endif %}
            </a>
        </td>
        <td>{% if event.budgetedevent_id != None %} 
            <a href="{% url 'budgetdb:update_be' event.budgetedevent_id %}"> <i class="fas fa-calendar"></i></a>
            {% endif %}</td>
        <td>{% if event.audit == 0 %} {{ event.cat1 }} {% endif %}</td>
        <td>{% if event.audit == 0 %} {{ event.cat2 }} {% endif %}</td>
        <td money>{{ event.calc_amount }}</td>
        <td>{% if event.audit == 0 %}
            <button type="button" class="btn btn-default btn-sm verify" onclick="toggleverifyT({{ event.id }})">
            </button> 
            {% endif %} 
        </td>
        <td>{% if event.receipt == 0 %}
            <button type="button" class="btn btn-default btn-sm receipt NORECEIPT" id=R{{event.id}} onclick="togglereceiptT({{ event.id }})">
            </button> 
            {% else %}
            <button type="button" class="btn btn-default btn-sm receipt RECEIPT" id=R{{event.id}} onclick="togglereceiptT({{ event.id }})">
            </button> 
            {% endif %} 
        </td>
        <td money>
            {% if event.audit == 0 %}
            {{ event.balance }}
            {% endif %} 
        </td>
        <td>{% if event.audit == 0 %}
            <button type="button" class="btn btn-default btn-sm audit" onclick="audit(event.date_actual, event.balance)">             
            </button>
            {% else %} 
            {{ event.balance }}
            {% endif %} 
        </td>
    </tr>
    {% endfor %}
</table> 

{% endblock %}


{% block script %}
<script>
    function toggleverifyT(transaction_id){
        data = {'transaction_id': transaction_id, 'csrfmiddlewaretoken': '{{csrf_token}}'}
        $.post('{% url "budgetdb:toggleverifytransaction_json" %}', data );
        modifiedtr=document.getElementById('T'+transaction_id)
        if (modifiedtr.attributes.class.nodeValue=='VERIFIED')
            modifiedtr.setAttribute('class','UNVERIFIED');
        else if (modifiedtr.attributes.class.nodeValue=='UNVERIFIED')
            modifiedtr.setAttribute('class','VERIFIED');
        else if (modifiedtr.attributes.class.nodeValue=='VERIFIED_BUDGET')
            modifiedtr.setAttribute('class','UNVERIFIED_BUDGET');
        else if (modifiedtr.attributes.class.nodeValue=='UNVERIFIED_BUDGET')
            modifiedtr.setAttribute('class','VERIFIED_BUDGET');
        else if (modifiedtr.attributes.class.nodeValue=='VERIFIED_MANUAL')
            modifiedtr.setAttribute('class','UNVERIFIED_MANUAL');
        else if (modifiedtr.attributes.class.nodeValue=='UNVERIFIED_MANUAL')
            modifiedtr.setAttribute('class','VERIFIED_MANUAL');
        else if (modifiedtr.attributes.class.nodeValue=='VERIFIED_MANUAL_BUDGET')
            modifiedtr.setAttribute('class','UNVERIFIED_MANUAL_BUDGET');
        else if (modifiedtr.attributes.class.nodeValue=='UNVERIFIED_MANUAL_BUDGET')
            modifiedtr.setAttribute('class','VERIFIED_MANUAL_BUDGET');

    }
   
    function togglereceiptT(transaction_id){
        data = {'transaction_id': transaction_id, 'csrfmiddlewaretoken': '{{csrf_token}}'}
        $.post('{% url "budgetdb:togglereceipttransaction_json" %}', data );
        modifiedtr=document.getElementById('R'+transaction_id)
        if (modifiedtr.attributes.class.nodeValue=='btn btn-default btn-sm receipt NORECEIPT')
            modifiedtr.setAttribute('class','btn btn-default btn-sm receipt RECEIPT');
        else if (modifiedtr.attributes.class.nodeValue=='btn btn-default btn-sm receipt RECEIPT')
            modifiedtr.setAttribute('class','btn btn-default btn-sm receipt NORECEIPT');
    }
     
</script>
{% endblock %}