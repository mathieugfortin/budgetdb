{% extends "budgetdb/base.html" %}
{% load static %}

{% block head_comment %}<!--echart template-->{% endblock %}
{% block title %}{{echart_title}}{% endblock %}
{% block content %}
<div class="btn-group" >
    {% for account_category in accountcategories  %}
        {% if account_category.id != ac|add:"0" %}
            <a class="btn btn-outline-info " href="{% url 'budgetdb:timeline_chart' %}?ac={{ account_category.id }}"> {{account_category.name}} </a>
        {% endif %}
    {% endfor %}

        <a class="btn btn-outline-info " href="{% url 'budgetdb:timeline_chart' %}"> All </a>
 
</div>

<div class="row" >
    <div class="col " >
        <div class="card " >
            <div class="card-body" id="chartdiv" style="height:80vh; " ></div>
        </div>
    </div>
</div>
{% endblock %}
{% block script %}
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"> </script>      

    <script type="text/javascript">
        // Create our number formatter.
        const formatter = new Intl.NumberFormat('en-US', {
            style: 'currency',
            currency: 'USD',
        });

        var chartDom = document.getElementById('chartdiv');
        var myChart = echarts.init(chartDom);
        let callback = (args) => {
            debugger;
            let mytooltip = args[0].axisValue + '<br />';
            let total = 0;
            for(let argN = 0; argN < args.length; ++ argN)
                {
                    let arg = args[argN];
                    mytooltip = mytooltip + '<div style="float: left;">' + arg.marker + ' ' + arg.seriesName  + ':  </div>   <div style="float: right;"><b > ' + formatter.format(arg.value) + '</b> </div><br />'; 
                    total = total + parseFloat(arg.value);
                }
            mytooltip = mytooltip + '<div style="float: left;">  Total: </div>   <div style="float: right;"><b > ' +  formatter.format(total) + '$</b>';
            return mytooltip;
        }
        let option;
        $(document).ready(function(){
            $.getJSON('{% url "budgetdb:echart_option_json" %}?ac={{ ac }}', function(data) {
                    option = data
                    option = Object.assign({
                        tooltip: {
                            trigger: 'axis',
                            formatter: callback
                            }
                        }, 
                        option )
                    option && myChart.setOption(option);
                    }
                );
            }
        );

        $(window).on('resize', resize);

        // Resize function
        function resize() {
        setTimeout(function () {
            // Resize chart
            myChart.resize();
        }, 200);
        }
    </script>
{% endblock %}